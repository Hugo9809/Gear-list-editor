#!/usr/bin/env node
import { readFileSync, writeFileSync, existsSync } from 'fs';
import { join, dirname } from 'path';
import { fileURLToPath } from 'url';

const __dirname = dirname(fileURLToPath(import.meta.url));

// Font files to embed (relative to app root, which is ../../../../ from here)
// Adjust these paths if you place fonts elsewhere (e.g. app/assets/fonts/ubuntu/)
const FONTS_DIR = join(__dirname, '../../../../../assets/fonts/Ubuntu');

const fonts = {
  'Ubuntu-Regular.ttf': 'Ubuntu-Regular.ttf',
  'Ubuntu-Bold.ttf': 'Ubuntu-Bold.ttf',
  'Ubuntu-Italic.ttf': 'Ubuntu-Italic.ttf',
  'Ubuntu-BoldItalic.ttf': 'Ubuntu-BoldItalic.ttf'
};

const vfs = {};
let foundCount = 0;

console.log(`Looking for fonts in: ${FONTS_DIR}`);

for (const [vfsName, filename] of Object.entries(fonts)) {
  const fontPath = join(FONTS_DIR, filename);
  if (existsSync(fontPath)) {
    const data = readFileSync(fontPath);
    vfs[vfsName] = data.toString('base64');
    foundCount++;
    console.log(`✅ Embed: ${filename}`);
  } else {
    console.warn(`⚠️ Missing: ${filename}`);
  }
}

if (foundCount === 0) {
  console.log('ℹ️ No Ubuntu fonts found. Generated empty VFS (will use Roboto fallback).');
}

const output = `// Auto-generated by gen:pdf-fonts
// Timestamp: ${new Date().toISOString()}
export const ubuntuVfs = ${JSON.stringify(vfs, null, 2)};
`;

writeFileSync(join(__dirname, 'ubuntu-vfs.js'), output);
console.log(`Written to ${join(__dirname, 'ubuntu-vfs.js')}`);
